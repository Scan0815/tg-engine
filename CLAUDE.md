# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- `npm run build` - Build the component library for production
- `npm start` - Start development server with hot reload and watch mode (`stencil build --dev --watch --serve`)
- `npm test` - Run all tests (spec and e2e)
- `npm run test.watch` - Run tests in watch mode
- `npm run generate` - Generate new StencilJS component scaffolding

## Architecture Overview

This is **TG Engine**, a lightweight 2D game engine built with StencilJS that provides web components for sprite-based games. The architecture follows StencilJS patterns with a component-driven approach.

### Core Structure

- **Components**: Located in `src/components/` with two main categories:
  - `engine/` - Core game engine components (sprites, colliders, camera, controllers)
  - `example/` - Example implementations and demo components
- **Managers**: Singleton pattern services in `src/manager/` (ColliderManager, AudioManager)
- **Interfaces**: TypeScript interfaces in `src/interfaces/` defining core data structures
- **Models**: Utility classes like Vector2 in `src/models/`

### Component Architecture

Each component follows StencilJS conventions:
- `.tsx` file with the component implementation
- `.scss` file for component-specific styles
- `test/` directory with `.spec.tsx` (unit) and `.e2e.ts` (end-to-end) tests
- Individual `readme.md` files generated by StencilJS

### Key Engine Components

- **tg-sprite**: Renders individual sprites from sprite sheets
- **tg-sprite-animator**: Handles sprite animation sequences
- **tg-sprite-map**: Tile-based map rendering system
- **tg-camera**: Camera system with target following and smooth interpolation
- **tg-collider**: Collision detection system managed by ColliderManager singleton
- **Controller components**: Handle input (key, mouse, touch)

### Build System

Uses StencilJS with multiple output targets:
- `dist/` - Standard distribution with ESM loader
- `dist-custom-elements` - Custom elements with auto-define behavior
- `docs-readme` - Auto-generated component documentation
- `www/` - Development server output

### Package Structure

The package exports individual components through specific paths:
```typescript
// Main entry
import { defineCustomElements } from 'tg-engine/loader';
// Individual components
import 'tg-engine/engine/tg-sprite';
```

### Testing Strategy

- Unit tests using Jest for component logic
- E2E tests using Puppeteer for integration testing
- Test files co-located with components in `test/` directories

### Development Patterns

- Components use TypeScript with StencilJS decorators (`@Component`, `@Prop`, `@State`, etc.)
- SCSS for styling with component-scoped styles
- Singleton managers for cross-component state (ColliderManager)
- Interface-driven development with TypeScript types exported from main entry point